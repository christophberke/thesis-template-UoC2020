\graphicspath{{chapters/1_basicfeatures/figures/}}

\chapter{Basic features of the template}
To compile the thesis, generate the bibliography, and ensure flawless cross-references between the table of contents, main text, citations, and bibliography, run
\begin{lstlisting}
lualatex main_thesis.tex
biber main_thesis
lualatex main_thesis.tex
lualatex main_thesis.tex
\end{lstlisting}
Of course, running these four commands manually every time is unnecessary. All \LaTeX editors I ever used (Sublime Text, VS Code, TeXstudio, TeXmaker, TeXShop, and Overleaf), allow you to set \verb|lualatex| as the default compiler and \verb|biber| as the bibliography processor. Additionally, all these editors enable you to define this sequence of commands as the standard build process, so your document is compiled correctly with a single action.

ADD COMPILER OPTIONS.

\paragraph{Why lualatex?} 
This template uses \verb|lualatex| instead of \verb|pdflatex| for two main reasons:
(i) Font Management: The template relies on the \verb|fontspec| package to handle different font types (e.g., sans-serif for captions and serif for the main text), which requires lualatex for compilation.
(ii) Memory Management: lualatex has a superior memory allocation system that dynamically adjusts as needed. This is particularly important when creating figures in \LaTeX with TikZ/pgfplots, where even simple 2D surface plots can lead to out-of-memory errors with \verb|pdflatex|.

Beyond these two reasons, \verb|lualatex| offers several other advantages, such as powerful Lua scripting capabilities. If you're interested, you can find numerous discussions on the benefits of \verb|lualatex| on \href{tex.stackexchange.com}{TeX Stack Exchange}.

\paragraph{Why biber and biblatex?}

This template uses \verb|biblatex| with the \verb|biber| backend instead of \verb|bibtex|. \verb|Biblatex| is more modern and versatile, and there’s virtually no reason to prefer \verb|bibtex| over \verb|biblatex|. The continued popularity of \verb|bibtex| is likely due to (bad) habit, both among users and some journals that still mandate its use.

For a thesis with a straightforward bibliography, \verb|bibtex| might be sufficient. However, \verb|biblatex| makes customization easier. Moreover, for more complex bibliography structures---such as our CRC183 project, which involves multiple independent bibliographies, cross-references between them, chapter-specific citation highlighting, and automatic correction of incorrect entries---\verb|bibtex| would have been completely inadequate.
See \chapref{chap:biblatex} for details.



\section{Documentclass}
This template is built on the \href{https://ctan.org/pkg/koma-script?lang=de}{KOMA-script} class \verb|scrbook|. Whether to use the standard \verb|book| class or its KOMA-Script counterpart is largely a matter of personal preference. The KOMA-Script bundle is widely recognized as an excellent package, and personally, I find \verb|scrbook| easier to customize while also preferring its default layout.

The document class is loaded with the following options:
\begin{lstlisting}
\documentclass[numbers=noenddot, headinclude = true,
	BCOR = 12mm, DIV = 16, twoside]{scrbook}
\end{lstlisting}
Below is an explanation of some of these options.

\subsection{Page layout without the \texttt{geometry} package}
One of the key strengths of the KOMA-Script classes is their built-in handling of type area and other typographic settings. The package author has extensive expertise in typography and has incorporated many best practices directly into its implementation. The KOMA-Script manual states:
 \say{Various algorithms and heuristic methods for constructing an appropriate type area have been discussed in the literature. These rules are known as the `canons of page construction.' [\ldots] The result is that the aspect ratio of the type area corresponds to the proportions of the page. [\ldots] In a two-sided document (e.g. a book), however, the entire inner margin (the margin at the spine) should be the same size as each of the two outer margins.} \cite{koma_manual}

The scrbook class automatically generates margins that conform to these typographic principles. The DIV parameter controls the type area width: the larger the value, the smaller the margins. The underlying construction mechanism is explained in Section 2.2 of the KOMA-Script manual, particularly in Figure 2.1.

Furthermore, \verb|headinclude=true| ensures that the header is included in the type area calculations as part of the text, and \verb|BCOR=12mm| adds a binding correction to the inner margin.

The KOMA-Script eliminates the need for the \verb|geometry| package that is otherwise often used to adjust margins. Manually setting margins can unintentionally violate typographic rules, potentially leading to poor readability. As the KOMA-Script manual warns:

\say{The practice of doing things oneself has long been widespread, but the results are often dubious because amateur typographers do not see what is wrong and cannot know what is important. This is how you get used to incorrect and poor typography. [...] Now, the objection could be made that typography is a matter of taste. When it comes to decoration, one could perhaps accept that argument, but since typography is primarily about information, not only can mistakes irritate, but they may even cause damage.}
(I recommend everyone to read Sec.~2.X of the manual, I enjoyed its polemic tone)

\paragraph{A confession} After emphasizing the importance of adhering to typographic best practices, I must confess: this template violates them.

For each combination of font size, font type (serif vs. sans-serif), and paper size, there is an optimal maximum number of characters per line to ensure readability. This determines the highest recommended \verb|DIV| value. The template uses \verb|DIV=16|, which exceeds the recommended value. As a result, LaTeX issues a \verb|Bad type area settings!| warning and suggests decreasing the \verb|DIV| value.
However, I deliberately chose smaller margins because I personally prefer this layout. My poor justification is that the recommended maximum character count per line is intended for inexperienced readers, whereas academic writing assumes a more advanced audience accustomed to dense text.



\section{Structure of the thesis}

According to the \href{https://mathnat.uni-koeln.de/sites/dekanat/official/Ordnungen/Promotionsordnung_2020.pdf}{`Promotionsordnung der math.-nat. Fakultät (2020)'} (PO2020), a Ph.D. thesis must include
\begin{itemize}
	\item a cover / title page,
	\item an abstract (PO2020 specifies that an English abstract is sufficient; a German version is not required),
	\item several chapters including an introduction, presentation of results, and discussion,
	\item the closing statement from §7 Absatz 8, PO2020, along with a list of your publications.
\end{itemize}
It is also common to include a thesis outline and acknowledgments. There is no universal consensus on where acknowledgments should be placed. In this template, they appear between the bibliography and the closing statement. However, other placements, such as directly after the title page and before the abstract, are also common. If I were to write my thesis again, I would likely choose that option.

Additionally, you should list your referees. In the published version (i.e., the version uploaded to the KUPS server after your defense, not the initial submission), you must also include the date of your defense and a statement confirming that the thesis was accepted by the faculty. This information should be printed either on the title page or its back. In this template, it is placed on the back of the title page.

A summary of the complete thesis structure is given in \tabref{tab:thesisstructure}.

\begin{table}
	\centering 
	\caption{\textbf{Structure of the thesis.}}
	\label{tab:thesistructure}
	\vspace{5ex}
	\begin{tabular}{lccccc} 
		\toprule
		 & page numbers & even/odd & in ToC & in pdf ToC & numbered  \\ 
		\midrule 
		Titlepage front  & none & odd & \color{bqred}\XSolidBrush& \color{bqgreen} \CheckmarkBold &\color{bqred} \XSolidBrush\\
		Titlepage back & none & even & \color{bqred}\XSolidBrush& \color{bqred}\XSolidBrush& \color{bqred}\XSolidBrush\\
		Abstract & none & odd & \color{bqred}\XSolidBrush& \color{bqgreen}\CheckmarkBold & \color{bqred}\XSolidBrush\\
		Table of Contents & roman & odd & \color{bqred}\XSolidBrush& \color{bqgreen}\CheckmarkBold &\color{bqred} \XSolidBrush\\
		Outline & arabic & odd &\color{bqgreen} \CheckmarkBold &\color{bqgreen} \CheckmarkBold & \color{bqred}\XSolidBrush\\
		Part page & none & odd & \color{bqgreen}\CheckmarkBold & \color{bqgreen}\CheckmarkBold & roman letters\\
		Chaptes & arabic & odd & \color{bqgreen}\CheckmarkBold &\color{bqgreen} \CheckmarkBold & numbers\\
		Appendices & arabic & odd & \color{bqgreen}\CheckmarkBold &\color{bqgreen} \CheckmarkBold & letters\\
		Bibliography & arabic & odd & \color{bqgreen}\CheckmarkBold & \color{bqgreen}\CheckmarkBold & \color{bqred}\XSolidBrush\\
		Acknowledgements & none & odd & \color{bqred}\XSolidBrush& \color{bqgreen}\CheckmarkBold & \color{bqred}\XSolidBrush\\
		Erklärung & none & odd & \color{bqred}\XSolidBrush&\color{bqgreen} \CheckmarkBold & \color{bqred}\XSolidBrush\\
		\bottomrule
	\end{tabular}
\end{table}

\subsection{Frontmatter, mainmatter and page numbering}
Books are typically divided into front matter and main matter (the back matter, which includes acknowledgments and the final statement, is not relevant for the following discussion since it uses the CHECLe
). In the \verb|tex| document, front matter and main matter are initialized via \verb|\frontmatter| and \verb|\mainmatter|. The front matter contains everything preceding the main content. It is common practice to use a different page numbering style for this section, typically Roman numerals or no numbering at all, while the main matter uses Arabic numerals.
In this thesis, the main matter begins with the Outline chapter. The front matter starts with the title page, but I opted not to display Roman numerals on the title page and abstract. Only the table of contents carries Roman numeral page numbers.

\subsection{Table of content}
The entire front matter should not be included in the table of contents (ToC). The same applies to the acknowledgments (which are often part of the front matter) and I also excluded the closing statement. However, I wanted all these sections to appear in the PDF table of contents (PDF-ToC), i.e., the strcuture that is displayed in the navigation pane of most PDF readers, see \figref{fig:pdf-toc}.

\begin{figure}
	\includegraphics[width = \textwidth]{pdf-toc.png}
	\caption{\textbf{Table of content vs. pdf table of content.} Thesis parts like the title page, abstract or acknowledgments should not be typeset in the table of content. However, for ease of navigation, it is useful if they appear in the navigation panel of the pdf reader.}
	\label{fig:pdf-toc}
\end{figure}

To customize the appearance of both the internal ToC and the PDF-ToC, the following commands are used:
\begin{itemize}
	\item \verb|\addcontentsline{toc}{chapter}{name}|  manually adds an entry to the ToC.  For example, \verb|\addcontentsline{toc}{chapter}{Bibliography}| ensures that the bibliography appears as a separate chapter in the ToC.
	\item \verb|\pdfbookmark[level]{Abstract}{abstract}| adds an entry to the PDF-ToC.
	\item \verb|\phantomsection| is sometimes necessary to ensure that hyperlinks between the PDF-ToC and the main document function correctly.
	\item \verb|\addchap{Outline}| ensures that the unnumbered Outline chapter appears both in the PDF-ToC and the ToC.
\end{itemize} 


\paragraph{Fixing the level in the pdf-toc}
In some cases, you may need to adjust the level at which an entry appears in the PDF-ToC. For example, consider the following thesis structure:
\begin{lstlisting}
\part{Part I}
	\chapter{Chapter 1}
	% ... 
\part{Part II}
	\chapter{Chapter 5}
	% ...
\chapter{Conclusion}
\end{lstlisting}
By default, the Conclusion chapter would be treated as a subchapter of Part II. However, you may prefer it to appear at the same level as the two parts. Here are two workarounds:
Before \verb|\chapter{Conclusion}|, insert
\begin{lstlisting}
\makeatletter
\def\toclevel@chapter{-1}
\makeatother
\chapter{Concluding discussion}
\end{lstlisting}
or load the bookmark package and insert
\begin{lstlisting}
\usepackage{bookmark}
...

\bookmarksetup{startatroot}
\chapter{Conclusion}
\end{lstlisting}


\section{Folder structure of the template}
The root folder contains the main file (\verb|main_thesis.tex|), font files, a \verb|.gitignore| and four subfolders: \verb|Latex| for all style/setting files, \verb|auxiliary| for the content of the front and back matter, \verb|bib-files| for \verb|.bib| files and \verb|chapters| for the content of the main matter part.
See \figref{fig:folderstructure} for a concise overview, including the substructure of the \verb|chapters| folder.

\begin{figure}
\begin{forest}
  pic dir tree,
  where level=0{}{% folder icons by default; override using file for file icons
    directory,
  },
  [root
    [main\_thesis.tex, file]
    [\fname{auxiliary}{all files for front and back matter}
      [\fname{abstract.tex}{one file for each front/back matter section: abstract, title page, acknowledgments, final statement.}, file]
      [\fname{logos}{Logos for title page}]
    ]
    [\fname{bib-files}{files with bibtex/biblatex entries}
    	[\fname{bibliography1.bib}{One or more .bib files}, file]
    ]
    [\fname{chapters}{main content}
    	[1\_introduction
    		[\fname{1\_introduction.tex}{main .tex file for chapter 1}, file]
    		[\fname{figures}{figures for chapter 1}]
    		[\fname{tikz\_figures}{TikZ source code for figures in chapter 1}
    		[\fname{tikz\_chap1\_fig1.tex}{A tex file for each figure in chapter 1}, file]
    		]
    	]
    	[\fname{...}{one folders for each chapter / appendix with equal substructure}]
    	[outline.tex, file]
    ]
    [\fname{latex}{folder for style definitions}
    	[\fname{layout.tex}{Layout settings}, file]
    	[\fname{...}{more files for TikZ styles, color definitions, custom \LaTeX commands, BibLaTeX settings, etc.}, file]
    ]
    [.gitignore, file]
    [\fname{otf/tff files with fonts}{optional font files}, file]
  ]
\end{forest}
\caption{\textbf{Structure of the template folder.}}
\label{fig:folderstructure}
\end{figure}

All individual tex files after the \verb|\begin{document}| are imported using \verb|\include{filename}|. If you want to compile only parts of the thesis, put an \verb|\includeonly{filename1,filename,...}| in the preamble. Due to the separate \verb|.aux| files that \verb|\include| produces, one then obtains still the correct numbering of pages/chapters/etc. Anyway, this is probably not a big issue during the writing process and using \verb|\import{filename}| instead is of course also fine.

At the beginning of each chapter, it is useful to set the graphicspath to the respective figure folder, e.g., \verb|\graphicspath{{chapters/1_basicfeatures/figures/}}| for this chapter, such that one can ommit the long graphics path when using the \verb|\includegraphics| command.


\section{Using TikZ / pgfplots and externalization}
When you use TikZ / pgfplots to generate your plots, you should use the externalization capabilities of TikZ in order to prevent re-rendering of unchanged figures whenever you compile. That saves a lot (!) of time. 
Remember that you have to include \verb|\usepackage{shellesc}| and compile with the \verb|--shell-escape| flag. Besides these general adjustements, there are two template-specific pecularities one has to keep in mind: 

\paragraph{Chapter headings} The modified chapter heading uses TikZ. Therefore, one should disable the externalization of TikZ before every new chapter. You can automate this by uncommenting this code snippet here in line ... of \verb|main_thesis.tex|:
\begin{lstlisting}
\let\oldchapter\chapter	% Store \chapter in \oldchapter
\renewcommand{\chapter}{%
	\tikzexternaldisable
	\oldchapter%
}
\end{lstlisting}
\paragraph{Modified folder structure}
I keep an additional folder \verb|tikz_figures| folder to store a separate .tex file with the tikz source code for every figure. That folder also contains the subfolder \verb|data| that in turn contains the data that is needed in the source code tikzfiles. At the beginning of each section, I set some paths to facilitate the inclusion of figures, for example
\begin{lstlisting}
\renewcommand{\here}{chapters/3_colors/tikz_figures}% Path to tikz source code
\pgfplotsset{table/search path={\here/data}}				% Path to data used in tikz source code
\tikzsetexternalprefix{chapters/3_colors/figures/}	% Path for storing of externalized tikz pdfs.
\end{lstlisting}
The \verb|\here| command is originally defined in the preamble of the document.
Then, the TikZ source code / the external pdf file is included via
\begin{lstlisting}
\begin{figure}
	\centering
	\tikzsetnextfilename{fig_colordemo}
	\input{\here/tikz_colordemo.tex}
	\caption{Some caption}
	\label{fig:colordemo}
\end{figure}
\end{lstlisting}
To see an example in action, checkout \chapref{cha:colors}.
Of course, there are many other options on how to organize the folder structure, in particular with regard to the externalization of TikZ-figures, just do what suits you best.

\section{``Outer theme'' layouting}

When dieses Template einen Wiedererkennungswert hat, dann ist es vermutlich das Layout der outer design elements. Darunter verstehe ich Kapitel- und auch Sectionüberschriften sowie header Zeile und auch die (von mir nie verwendete Part Page).
Wenn du dieses Template verwenden, aber gleichzeitig nicht das Erscheinungsbild komplett übernehmen willst (womit ich auch kein Problem habe, siehe alle Thesis, die nach meiner in unserer Gruppe veröffentlicht worden sind, Stand Januar 25), dann ist es am einfachsten, diese Design-Element anzupassen.
Die meisten Styles werden in der Datei ... definiert.


\subsection{Accent color}
Diese Arbeit benutzt zwei Accent Colors, accentcolor1 und accentcolor2.
In meinem Fall ist cardianl rot und warm grey.
Accent1 wird fuer alle Ueberschriften und zum Highlighten auf der Titleseite benutzt. Accent2 wird ebenfalls in der Kapitelueberschrift benutzt, sowie im header.

\subsection{Chapter headings}
Das Design Element ... wird dort definiert. Einfach mal ausklammern, dann bekommt man das Standard Koma Skript Layout.

HOW TO ADD LINEBREAK IN CAPTIONS!

\subsection{Mathe in Captions}

\subsection{Part pages}
Part pages benutze ich nicht. Ich habe darueber nachgedacht, die Einleitungskapitel zu einem Part zusammenzufassen und auch die Resultatkapiteln. Eigentlich finde ich aber, dass das unnatuerliche Brueche in der Arbeit einfuegt. Fuer mich ist ein gutes Anwendungsbeispiel eigentlich nur, wenn man in der Arbeit komplett disjunkte Themen behandelt, also z.B. Transmon-Physik und Kitaev Spin LIquids. Ich verstecke aber alles zu den KSL in einem Anhang. Das einzige was fuer eine Part Page gesprochen haette waere gewesen, dass die irgendwie recht cool aussehen, aber das hat mich dann nicht endgueltig ueberzeugt.
Anyway, falls du PartPages benutzen willst dann geht das so:
Das Layout steht hier und kann easy angepasst werden, z.B. ein Farbgradient oder ein Hintergrundbild.

\section{Sections and subsections}
-table of content layer
-schmale Schriftart, hier festgelegt.

\subsection{Subsubsections and Paragraphs}
Ich benutze keine Subsubsections sondern nur Paragraphs.

\subsection{Figure captions}

\subsection{Header}
Der header benutzt ebenfalls die gleiche Serifenlose Font wie ...

WIE PASST MAN AN WIE VIEL TEXT AUF EINE SEITE DARF?

